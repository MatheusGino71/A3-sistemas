# Integra√ß√£o Firebase - Sentinela PIX

## üî• O que foi implementado

A autentica√ß√£o do sistema Sentinela PIX foi migrada para o **Firebase Authentication** e **Firestore**, substituindo o sistema anterior baseado em SQLite + JWT.

## üìã Arquivos modificados

### 1. `frontend/firebase-config.js` (NOVO)
- Arquivo de configura√ß√£o centralizado do Firebase
- Inicializa os servi√ßos: Authentication, Firestore, Storage e Analytics
- Exporta inst√¢ncias para uso em todo o projeto

### 2. `frontend/cadastro.html`
**Mudan√ßas:**
- Substitu√≠do `fetch()` para backend por `createUserWithEmailAndPassword()` do Firebase Auth
- Dados adicionais (nome, sobrenome, CPF, telefone, banco) s√£o salvos no Firestore
- Mensagens de erro espec√≠ficas do Firebase (email duplicado, senha fraca, etc.)
- Usa `type="module"` para importar o Firebase

**Fluxo de cadastro:**
```
1. Usu√°rio preenche formul√°rio
2. Firebase Auth cria usu√°rio com email/senha
3. Firestore salva dados adicionais em /users/{uid}
4. localStorage atualizado com uid, nome, email
5. Redirecionamento para dashboard.html
```

### 3. `frontend/login.html`
**Mudan√ßas:**
- Substitu√≠do `fetch()` para backend por `signInWithEmailAndPassword()` do Firebase Auth
- Busca dados adicionais do Firestore ap√≥s login
- Tratamento de erros espec√≠ficos do Firebase
- Usa `type="module"` para importar o Firebase

**Fluxo de login:**
```
1. Usu√°rio digita email/senha
2. Firebase Auth autentica credenciais
3. Busca dados do usu√°rio no Firestore /users/{uid}
4. localStorage atualizado com todos os dados
5. Redirecionamento para dashboard.html
```

### 4. `frontend/dashboard.html`
**Mudan√ßas:**
- Adicionado `onAuthStateChanged()` para verificar autentica√ß√£o
- Redireciona para login.html se n√£o autenticado
- Busca dados atualizados do Firestore ao carregar
- Fun√ß√£o global `handleLogout()` para desconectar

**Prote√ß√£o de rota:**
```javascript
onAuthStateChanged(auth, (user) => {
    if (!user) {
        window.location.href = 'login.html';
    }
});
```

## üîê Estrutura de dados no Firestore

### Cole√ß√£o: `users`
Documento ID: `{uid}` (gerado pelo Firebase Auth)

```json
{
  "nome": "Jo√£o",
  "sobrenome": "Silva",
  "email": "joao@example.com",
  "cpf": "12345678900",
  "telefone": "11999999999",
  "banco": "Bradesco",
  "createdAt": "2025-01-23T12:00:00.000Z",
  "updatedAt": "2025-01-23T12:00:00.000Z"
}
```

## üéØ Vantagens da integra√ß√£o Firebase

### 1. **Seguran√ßa**
- Autentica√ß√£o gerenciada pelo Google
- Tokens JWT autom√°ticos e seguros
- Prote√ß√£o contra ataques de for√ßa bruta
- Criptografia de senhas em n√≠vel empresarial

### 2. **Escalabilidade**
- Banco de dados NoSQL escal√°vel (Firestore)
- Sem necessidade de gerenciar servidores
- Alta disponibilidade global

### 3. **Recursos adicionais prontos**
- Login social (Google, Facebook, GitHub, etc.) - f√°cil de adicionar
- Redefini√ß√£o de senha autom√°tica por email
- Verifica√ß√£o de email
- Autentica√ß√£o multifator (MFA)

### 4. **Analytics integrado**
- Rastreamento autom√°tico de eventos
- M√©tricas de usu√°rios ativos
- Funil de convers√£o

## üì¶ Depend√™ncias

**Firebase SDK via CDN:**
- firebase-app: 10.7.1
- firebase-auth: 10.7.1
- firebase-firestore: 10.7.1
- firebase-storage: 10.7.1
- firebase-analytics: 10.7.1

## üöÄ Como usar

### Cadastro de novo usu√°rio:
1. Acesse `http://localhost:8080/cadastro.html`
2. Preencha todos os campos
3. Clique em "Criar Conta"
4. Verifique no Firebase Console se o usu√°rio foi criado

### Login:
1. Acesse `http://localhost:8080/login.html`
2. Digite email e senha
3. Clique em "Entrar"
4. Voc√™ ser√° redirecionado para o dashboard

### Logout:
- Basta chamar `handleLogout()` de qualquer lugar do dashboard
- O usu√°rio ser√° desconectado e redirecionado para login

## üîç Verifica√ß√£o no Firebase Console

1. Acesse: https://console.firebase.google.com
2. Selecione o projeto: **a3-quinta-1a763**
3. Navegue at√©:
   - **Authentication > Users**: Ver usu√°rios cadastrados
   - **Firestore Database > users**: Ver dados adicionais
   - **Analytics**: Ver m√©tricas de uso

## ‚ö†Ô∏è Observa√ß√µes importantes

### Backend atual (backend/server.js)
- As rotas `/api/v1/users/register` e `/api/v1/users/login` **n√£o s√£o mais usadas**
- Podem ser removidas ou mantidas como fallback
- Os relat√≥rios de fraude ainda usam o backend Node.js + SQLite

### Pr√≥ximos passos sugeridos:
1. **Migrar relat√≥rios de fraude para Firestore** (opcional)
   - Criar cole√ß√µes: `fraudReports`, `riskAnalysis`, `notifications`
   - Usar regras de seguran√ßa do Firestore para controle de acesso

2. **Adicionar login social** (f√°cil com Firebase)
   ```javascript
   import { signInWithPopup, GoogleAuthProvider } from 'firebase/auth';
   const provider = new GoogleAuthProvider();
   await signInWithPopup(auth, provider);
   ```

3. **Implementar recupera√ß√£o de senha**
   ```javascript
   import { sendPasswordResetEmail } from 'firebase/auth';
   await sendPasswordResetEmail(auth, email);
   ```

4. **Adicionar verifica√ß√£o de email**
   ```javascript
   import { sendEmailVerification } from 'firebase/auth';
   await sendEmailVerification(user);
   ```

## üêõ Troubleshooting

### Erro: "Failed to load firebase-config.js"
- Certifique-se de que o servidor est√° rodando na porta 8080
- Verifique se o arquivo `firebase-config.js` est√° na pasta `frontend/`

### Erro: "auth/network-request-failed"
- Verifique sua conex√£o com a internet
- Confirme se as chaves do Firebase est√£o corretas

### Erro: "Firestore: Missing or insufficient permissions"
- Acesse Firebase Console > Firestore > Rules
- Configure as regras de seguran√ßa adequadas

## üìù Regras de seguran√ßa recomendadas (Firestore)

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Permitir leitura/escrita apenas do pr√≥prio usu√°rio
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Relat√≥rios de fraude (exemplo)
    match /fraudReports/{reportId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
  }
}
```

## ‚úÖ Checklist de migra√ß√£o

- [x] Firebase configurado e inicializado
- [x] Cadastro usando Firebase Auth
- [x] Login usando Firebase Auth
- [x] Dados adicionais salvos no Firestore
- [x] Prote√ß√£o de rota no dashboard
- [x] Fun√ß√£o de logout implementada
- [ ] Migra√ß√£o de dados existentes do SQLite (se necess√°rio)
- [ ] Testes completos de fluxo de autentica√ß√£o
- [ ] Configurar regras de seguran√ßa no Firestore
- [ ] Adicionar recupera√ß√£o de senha
- [ ] Adicionar verifica√ß√£o de email

## üìö Documenta√ß√£o oficial

- Firebase Auth: https://firebase.google.com/docs/auth
- Firestore: https://firebase.google.com/docs/firestore
- Firebase Web SDK: https://firebase.google.com/docs/web/setup
