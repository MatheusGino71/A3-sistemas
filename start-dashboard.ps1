# Sentinela PIX - Dashboard Startup Script
# Executa o frontend dashboard em servidor local

Write-Host "üõ°Ô∏è  Iniciando Sentinela PIX Dashboard..." -ForegroundColor Cyan
Write-Host ""

# Verificar se est√° na pasta correta
$currentPath = Get-Location
$frontendPath = Join-Path $currentPath "frontend"

if (-not (Test-Path $frontendPath)) {
    Write-Host "‚ùå Pasta 'frontend' n√£o encontrada!" -ForegroundColor Red
    Write-Host "   Execute este script a partir da pasta raiz do projeto sentinela-pix" -ForegroundColor Yellow
    Write-Host ""
    Read-Host "Pressione Enter para continuar..."
    exit 1
}

# Navegar para a pasta frontend
Set-Location $frontendPath

Write-Host "üìÇ Diret√≥rio atual: $frontendPath" -ForegroundColor Green
Write-Host ""

# Verificar se os arquivos existem
$requiredFiles = @("index.html", "dashboard.html", "dashboard.js", "styles.css")
$missingFiles = @()

foreach ($file in $requiredFiles) {
    if (-not (Test-Path $file)) {
        $missingFiles += $file
    }
}

if ($missingFiles.Count -gt 0) {
    Write-Host "‚ùå Arquivos necess√°rios n√£o encontrados:" -ForegroundColor Red
    foreach ($file in $missingFiles) {
        Write-Host "   - $file" -ForegroundColor Yellow
    }
    Write-Host ""
    Read-Host "Pressione Enter para continuar..."
    exit 1
}

Write-Host "‚úÖ Todos os arquivos necess√°rios encontrados!" -ForegroundColor Green
Write-Host ""

# Tentar diferentes m√©todos para servir o dashboard
Write-Host "üöÄ Tentando iniciar o servidor web..." -ForegroundColor Cyan
Write-Host ""

# M√©todo 1: Python
try {
    $pythonVersion = python --version 2>$null
    if ($pythonVersion) {
        Write-Host "üêç Python encontrado: $pythonVersion" -ForegroundColor Green
        Write-Host "   Iniciando servidor Python HTTP..." -ForegroundColor Cyan
        Write-Host ""
        Write-Host "üì° Dashboard dispon√≠vel em:" -ForegroundColor Green
        Write-Host "   üëâ http://localhost:8080" -ForegroundColor Yellow
        Write-Host ""
        Write-Host "‚ö†Ô∏è  Para parar o servidor, pressione Ctrl+C" -ForegroundColor Yellow
        Write-Host ""
        
        # Tentar abrir o navegador automaticamente
        try {
            Start-Process "http://localhost:8080"
            Write-Host "üåê Abrindo navegador automaticamente..." -ForegroundColor Green
        }
        catch {
            Write-Host "üåê Abra manualmente: http://localhost:8080" -ForegroundColor Yellow
        }
        
        Write-Host ""
        Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Cyan
        Write-Host "                SENTINELA PIX DASHBOARD                " -ForegroundColor White
        Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Cyan
        Write-Host ""
        
        # Executar servidor Python
        python -m http.server 8080
        exit 0
    }
}
catch {
    Write-Host "‚ùå Python n√£o encontrado, tentando alternativas..." -ForegroundColor Yellow
}

# M√©todo 2: Node.js/npm
try {
    $nodeVersion = node --version 2>$null
    if ($nodeVersion) {
        Write-Host "üü¢ Node.js encontrado: $nodeVersion" -ForegroundColor Green
        
        # Verificar se http-server est√° instalado
        $httpServer = npx --version 2>$null
        if ($httpServer) {
            Write-Host "   Iniciando servidor Node.js HTTP..." -ForegroundColor Cyan
            Write-Host ""
            Write-Host "üì° Dashboard dispon√≠vel em:" -ForegroundColor Green
            Write-Host "   üëâ http://localhost:8080" -ForegroundColor Yellow
            Write-Host ""
            
            # Tentar abrir o navegador
            try {
                Start-Process "http://localhost:8080"
                Write-Host "üåê Abrindo navegador automaticamente..." -ForegroundColor Green
            }
            catch {
                Write-Host "üåê Abra manualmente: http://localhost:8080" -ForegroundColor Yellow
            }
            
            Write-Host ""
            Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Cyan
            Write-Host "                SENTINELA PIX DASHBOARD                " -ForegroundColor White
            Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Cyan
            Write-Host ""
            
            # Executar servidor Node
            npx http-server -p 8080 --cors
            exit 0
        }
    }
}
catch {
    Write-Host "‚ùå Node.js n√£o encontrado ou erro na execu√ß√£o" -ForegroundColor Yellow
}

# M√©todo 3: Instru√ß√µes manuais
Write-Host ""
Write-Host "‚ùå N√£o foi poss√≠vel iniciar um servidor automaticamente" -ForegroundColor Red
Write-Host ""
Write-Host "üìã Para executar o dashboard manualmente:" -ForegroundColor Cyan
Write-Host ""
Write-Host "   Op√ß√£o 1 - Python:" -ForegroundColor White
Write-Host "   1. Instale o Python (https://python.org)" -ForegroundColor Gray
Write-Host "   2. Execute: python -m http.server 8080" -ForegroundColor Gray
Write-Host ""
Write-Host "   Op√ß√£o 2 - Node.js:" -ForegroundColor White
Write-Host "   1. Instale o Node.js (https://nodejs.org)" -ForegroundColor Gray
Write-Host "   2. Execute: npx http-server -p 8080" -ForegroundColor Gray
Write-Host ""
Write-Host "   Op√ß√£o 3 - VS Code:" -ForegroundColor White
Write-Host "   1. Instale a extens√£o 'Live Server'" -ForegroundColor Gray
Write-Host "   2. Clique direito em index.html > Open with Live Server" -ForegroundColor Gray
Write-Host ""
Write-Host "   Op√ß√£o 4 - Arquivo Local:" -ForegroundColor White
Write-Host "   1. Abra o arquivo index.html diretamente no navegador" -ForegroundColor Gray
Write-Host "   2. Algumas funcionalidades podem n√£o funcionar via file://" -ForegroundColor Yellow
Write-Host ""

# Tentar abrir o arquivo local como fallback
$indexFile = Join-Path $frontendPath "index.html"
Write-Host "üîó Tentando abrir arquivo local..." -ForegroundColor Cyan
try {
    Start-Process $indexFile
    Write-Host "‚úÖ Arquivo aberto no navegador padr√£o" -ForegroundColor Green
}
catch {
    Write-Host "‚ùå Erro ao abrir arquivo: $_" -ForegroundColor Red
}

Write-Host ""
Read-Host "Pressione Enter para continuar..."