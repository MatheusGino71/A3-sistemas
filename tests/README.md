# üß™ Guia de Testes E2E - ZENIT

## üìã √çndice

1. [Vis√£o Geral](#vis√£o-geral)
2. [Configura√ß√£o](#configura√ß√£o)
3. [Executando Testes](#executando-testes)
4. [Estrutura dos Testes](#estrutura-dos-testes)
5. [Escrevendo Novos Testes](#escrevendo-novos-testes)
6. [CI/CD Integration](#cicd-integration)
7. [Troubleshooting](#troubleshooting)

---

## üéØ Vis√£o Geral

Os testes E2E (End-to-End) do ZENIT utilizam **Playwright** para validar fluxos completos da aplica√ß√£o, simulando intera√ß√µes reais de usu√°rios.

### Cobertura de Testes

- ‚úÖ **Homepage** - Navega√ß√£o inicial, responsividade
- ‚úÖ **Autentica√ß√£o** - Login, cadastro, valida√ß√µes
- ‚úÖ **Dashboard** - Funcionalidades principais, menu, logout
- ‚úÖ **Den√∫ncias** - Cria√ß√£o de novas den√∫ncias
- ‚úÖ **An√°lise de Risco** - Verifica√ß√£o de chaves PIX
- ‚úÖ **Perfil** - Visualiza√ß√£o de dados do usu√°rio

---

## üîß Configura√ß√£o

### 1. Instalar Depend√™ncias

```bash
# Na raiz do projeto
npm install

# Instalar navegadores do Playwright
npx playwright install
```

### 2. Verificar Configura√ß√£o

O arquivo `playwright.config.js` j√° est√° configurado com:

- **Base URL**: http://localhost:8080
- **Timeout**: 10 segundos por a√ß√£o
- **Screenshots**: Apenas em falhas
- **V√≠deos**: Apenas em falhas
- **Reports**: HTML + JSON

### 3. Servidores

Os testes iniciam automaticamente:
- **Backend**: http://localhost:3001
- **Frontend**: http://localhost:8080

---

## üöÄ Executando Testes

### Comandos B√°sicos

```bash
# Executar todos os testes
npm test

# Executar com interface visual
npm run test:headed

# Executar com UI interativa
npm run test:ui

# Debug mode (passo a passo)
npm run test:debug

# Ver relat√≥rio HTML
npm run test:report

# Executar apenas Chromium
npm run test:chromium
```

### Executar Testes Espec√≠ficos

```bash
# Apenas homepage
npx playwright test homepage

# Apenas autentica√ß√£o
npx playwright test auth

# Apenas dashboard
npx playwright test dashboard

# Apenas um arquivo
npx playwright test tests/e2e/auth-login.spec.js
```

### Executar com Filtros

```bash
# Apenas testes que contenham "login"
npx playwright test -g "login"

# Ignorar testes que contenham "skip"
npx playwright test --grep-invert "skip"
```

---

## üìÇ Estrutura dos Testes

```
tests/
‚îî‚îÄ‚îÄ e2e/
    ‚îú‚îÄ‚îÄ homepage.spec.js         # Testes da p√°gina inicial
    ‚îú‚îÄ‚îÄ auth-login.spec.js       # Testes de login
    ‚îú‚îÄ‚îÄ auth-register.spec.js    # Testes de cadastro
    ‚îî‚îÄ‚îÄ dashboard.spec.js        # Testes do dashboard
```

### Estrutura de um Teste

```javascript
import { test, expect } from '@playwright/test';

test.describe('Grupo de Testes', () => {
  test.beforeEach(async ({ page }) => {
    // Setup antes de cada teste
    await page.goto('/');
  });

  test('deve fazer algo espec√≠fico', async ({ page }) => {
    // 1. Arrange - Preparar
    const button = page.getByRole('button', { name: /clique/i });
    
    // 2. Act - Agir
    await button.click();
    
    // 3. Assert - Verificar
    await expect(page).toHaveURL(/sucesso/);
  });
});
```

---

## ‚úçÔ∏è Escrevendo Novos Testes

### 1. Criar Novo Arquivo

```bash
# Criar arquivo de teste
touch tests/e2e/meu-teste.spec.js
```

### 2. Template B√°sico

```javascript
import { test, expect } from '@playwright/test';

test.describe('Minha Feature', () => {
  test('deve funcionar corretamente', async ({ page }) => {
    await page.goto('/minha-pagina');
    
    // Seu teste aqui
    await expect(page.locator('h1')).toBeVisible();
  });
});
```

### 3. Locators Recomendados

```javascript
// ‚úÖ BOM - Por role (acessibilidade)
page.getByRole('button', { name: /enviar/i })
page.getByRole('link', { name: /login/i })

// ‚úÖ BOM - Por texto
page.getByText('Bem-vindo')
page.getByLabel('Email')

// ‚úÖ BOM - Por placeholder
page.getByPlaceholder('Digite seu email')

// ‚ö†Ô∏è EVITAR - Por classe ou ID (fr√°gil)
page.locator('.my-class')
page.locator('#my-id')
```

### 4. Assertions Comuns

```javascript
// Visibilidade
await expect(element).toBeVisible()
await expect(element).toBeHidden()

// Texto
await expect(element).toContainText('texto')
await expect(element).toHaveText('texto exato')

// URL
await expect(page).toHaveURL(/dashboard/)
await expect(page).toHaveTitle(/ZENIT/)

// Atributos
await expect(element).toHaveAttribute('required')
await expect(element).toHaveClass(/active/)

// Estado
await expect(checkbox).toBeChecked()
await expect(button).toBeEnabled()
```

---

## üîÑ CI/CD Integration

### GitHub Actions

Os testes s√£o executados automaticamente no CI/CD:

```yaml
# .github/workflows/ci.yml
- name: Test Frontend
  run: |
    npm install
    npx playwright install --with-deps chromium
    npm test
```

### Vari√°veis de Ambiente

```bash
# CI mode
CI=true npm test

# Custom base URL
BASE_URL=https://staging.zenit.com npm test
```

---

## üêõ Troubleshooting

### Problema: Testes Falhando Aleatoriamente

**Solu√ß√£o**: Aumentar timeouts

```javascript
test.use({ 
  actionTimeout: 15000,
  navigationTimeout: 30000 
});
```

### Problema: Servidor n√£o inicia

**Solu√ß√£o**: Verificar portas

```bash
# Windows
netstat -ano | findstr :3001
netstat -ano | findstr :8080

# Matar processo
taskkill /PID <pid> /F
```

### Problema: Elemento n√£o encontrado

**Solu√ß√£o**: Esperar pelo elemento

```javascript
// Esperar visibilidade
await page.waitForSelector('.my-element', { state: 'visible' });

// Esperar resposta da API
await page.waitForResponse(response => 
  response.url().includes('/api/v1/')
);
```

### Problema: Screenshot/V√≠deo n√£o salvando

**Solu√ß√£o**: Verificar configura√ß√£o

```javascript
// playwright.config.js
use: {
  screenshot: 'only-on-failure',
  video: 'retain-on-failure',
  trace: 'on-first-retry',
}
```

### Debug: Ver o que est√° acontecendo

```bash
# Modo debug (abre DevTools)
npm run test:debug

# Headed mode (ver browser)
npm run test:headed

# UI mode (interface interativa)
npm run test:ui

# Trace viewer (replay)
npx playwright show-trace trace.zip
```

---

## üìä Reports

### HTML Report

```bash
# Gerar e abrir relat√≥rio
npm run test:report
```

O relat√≥rio inclui:
- ‚úÖ Testes passados/falhados
- üì∏ Screenshots de falhas
- üé• V√≠deos de falhas
- üìù Logs detalhados
- ‚è±Ô∏è Tempos de execu√ß√£o

### JSON Report

Localizado em: `tests/reports/test-results.json`

√ötil para integra√ß√£o com outras ferramentas.

---

## üéØ Melhores Pr√°ticas

### 1. Isolamento de Testes

```javascript
// ‚úÖ Cada teste deve ser independente
test('teste 1', async ({ page }) => {
  // N√£o depende de outros testes
});

test('teste 2', async ({ page }) => {
  // N√£o depende de outros testes
});
```

### 2. Evitar Sleeps

```javascript
// ‚ùå RUIM
await page.waitForTimeout(5000);

// ‚úÖ BOM
await page.waitForSelector('.loaded');
await page.waitForResponse(res => res.url().includes('/api/'));
```

### 3. Usar Page Object Model

```javascript
// pages/LoginPage.js
export class LoginPage {
  constructor(page) {
    this.page = page;
    this.emailInput = page.locator('input[type="email"]');
    this.passwordInput = page.locator('input[type="password"]');
    this.submitButton = page.getByRole('button', { name: /login/i });
  }

  async login(email, password) {
    await this.emailInput.fill(email);
    await this.passwordInput.fill(password);
    await this.submitButton.click();
  }
}

// Uso
const loginPage = new LoginPage(page);
await loginPage.login('user@test.com', 'password');
```

### 4. Limpar Dados de Teste

```javascript
test.afterEach(async ({ page }) => {
  // Limpar cookies
  await page.context().clearCookies();
  
  // Limpar localStorage
  await page.evaluate(() => localStorage.clear());
});
```

---

## üìö Recursos

- **Playwright Docs**: https://playwright.dev/
- **Best Practices**: https://playwright.dev/docs/best-practices
- **API Reference**: https://playwright.dev/docs/api/class-page
- **VS Code Extension**: Playwright Test for VSCode

---

## ü§ù Contribuindo

### Adicionar Novo Teste

1. Criar arquivo em `tests/e2e/`
2. Seguir padr√£o de nomenclatura: `feature.spec.js`
3. Adicionar descri√ß√£o clara do que testa
4. Executar localmente antes de commitar
5. Verificar se passa no CI

### Review Checklist

- [ ] Testes s√£o independentes
- [ ] Usa locators acess√≠veis (role, text, label)
- [ ] N√£o usa timeouts fixos
- [ ] Tem assertions claras
- [ ] Falhas geram screenshots √∫teis
- [ ] Documenta√ß√£o atualizada

---

**üåü ZENIT** - Sistema Anti-Fraude PIX  
*Testes automatizados para qualidade garantida!*
